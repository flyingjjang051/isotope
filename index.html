<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <meta name="referrer" content="no-referrer" /> -->
    <title>GALLERY</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="css/fancybox.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/dayjs.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/greensock/gsap.min.js"></script>
    <script src="js/fancybox.umd.js"></script>
  </head>
  <body>
    <header id="header">
      <h1><strong>GALLERY</strong></h1>
    </header>
    <main id="main">
      <div id="search">
        <input type="text" id="searchTxt" />
        <button><span class="material-icons"> search </span></button>
      </div>
      <div id="recentSearch">
        <ul class="list"></ul>
      </div>
      <div id="result">
        <ul class="list">
          <!-- <li>
            <a href="">
              <img src="" alt="" />
              <div class="info">
                <h2>제목이 들어갑니다.</h2>
                <p>내용이 들어갑니다. 내용이 들어갑니다. 내용이 들어갑니다. 내용이 들어갑니다. 내용이 들어갑니다.</p>
              </div>
            </a>
          </li> -->
        </ul>
      </div>
    </main>
  </body>
  <script>
    const list = $("#result .list");
    const recentSearchList = $("#recentSearch .list");
    let recentSearchArray = [];
    const btnSearch = $("#search button");
    const searchTxt = $("#searchTxt");
    const body = $("body");
    let parseData = JSON.parse(localStorage.getItem("recentSearchArray"));
    if (parseData !== null) {
      recentSearchArray = [...new Set(parseData)]; // 전지현,김태희,설현
    }

    console.log("배열은 참조한다.===", recentSearchArray === parseData);
    console.log("recentSearchArray.===", recentSearchArray);
    const parseLocalStorage = function () {
      recentSearchArray = [...new Set(parseData)];
      let tempHtml = "";
      $.each(recentSearchArray, function (idx, item) {
        tempHtml += `<li>${item}</li>`;
      });
      recentSearchList.html(tempHtml);
    };
    parseLocalStorage();
    const gallery = list.isotope({
      itemSelector: ".item",
      percentPosition: true,
    });
    btnSearch.on("click", function () {
      kakaoSearch(searchTxt.val());
    });
    searchTxt.on("keydown", function (e) {
      if (e.keyCode === 13) {
        kakaoSearch(searchTxt.val());
      }
    });
    const kakaoSearch = function (search) {
      $.ajax({
        url: "https://dapi.kakao.com/v2/search/image",
        headers: {
          Authorization: "KakaoAK 13215f3216644f68b281e1f7eda3b396",
        },
        data: {
          query: search,
          size: 20,
        },
      }).done(function (response) {
        recentSearchArray.push(searchTxt.val());
        localStorage.setItem("recentSearchArray", JSON.stringify(recentSearchArray));
        parseLocalStorage();
        console.log(recentSearchArray);

        let tempHtml = "";
        $.each(response.documents, function (idx, item) {
          //console.log(item);
          const date = dayjs(item.datetime, "YYYY-MM-dd HH:mm:ss"); // 날짜를 하나 생성
          tempHtml += `<li class="item">
          <a href="${item.image_url}" data-fancybox="image">
            <img src="${item.image_url}" alt="" />
            <div class="info">
              <p class="date">${date.format("YYYY/MM/DD HH:mm:ss")}</p>
            </div>
          </a>
        </li>`;
        });
        list.html(tempHtml);
        list.imagesLoaded().progress(function (instance, image) {
          list.isotope({
            itemSelector: ".item",
            percentPosition: true,
          });
          list.isotope("reloadItems");
        });
      });
    };
    //    kakaoSearch("김태희");
  </script>
</html>
